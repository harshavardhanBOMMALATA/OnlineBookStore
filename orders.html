<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Orders</title>

  <style>
    body { font-family: Arial; background:#f5f5f5; margin:0; }

    /* NAVBAR */
    .navbar {
      background:#ffffff;
      padding:12px 24px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      border-bottom:1px solid #ddd;
      position:relative;
    }
    .logo { color:#e84949; font-size:22px; font-weight:bold; }
    .user-area { display:flex; align-items:center; gap:10px; }
    .user-icon { width:34px; height:34px; border-radius:50%; cursor:pointer; }

    .user-box {
      position:absolute; top:56px; right:24px;
      background:white; padding:14px; width:240px;
      border-radius:10px; display:none;
      box-shadow:0 2px 12px rgba(0,0,0,0.2);
    }
    .logout-btn {
      width:100%; padding:8px;
      background:#e84949; border:none;
      color:#fff; border-radius:6px;
      cursor:pointer; margin-top:10px;
    }

    /* ORDERS SECTION */
    .orders-container { padding:24px; padding-bottom:100px; }

    .order-box {
      background:white; padding:16px;
      border-radius:10px; margin-bottom:25px;
      box-shadow:0 1px 8px rgba(0,0,0,0.12);
    }

    .order-title {
      font-size:18px;
      font-weight:bold;
      color:#e84949;
    }

    .order-info {
      margin-top:10px;
      font-size:14px;
      color:#444;
      line-height:22px;
    }

    .order-items {
      background:#f9f9f9;
      padding:12px;
      border-radius:8px;
      margin-top:12px;
    }

    .order-item {
      padding:8px 0;
      border-bottom:1px solid #eee;
    }
    .order-item:last-child {
      border-bottom:none;
    }

    .total-price {
      margin-top:12px;
      font-size:16px;
      font-weight:bold;
      color:#e84949;
    }

    .delivered-tag {
      margin-top:10px;
      padding:10px;
      background:#e9ffe9;
      border-left:4px solid #079607;
      color:#046b04;
      border-radius:6px;
      font-weight:bold;
      font-size:14px;
    }

    /* FOOTER FIXED */
    .footer {
      position:fixed; bottom:0; left:0;
      width:100%; background:white;
      padding:10px; border-top:1px solid #ddd;
      text-align:center; font-size:13px;
      z-index:1000;
    }
  </style>
</head>

<body>

<!-- NAVBAR -->
<header class="navbar">
  <div class="logo">All Orders ðŸ§¾</div>

  <div class="user-area">
    <span id="userNameText"></span>
    <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
         class="user-icon" onclick="toggleUserBox()">
  </div>

  <div id="userBox" class="user-box">
    <p><strong>Name:</strong> <span id="uName"></span></p>
    <p><strong>Email:</strong> <span id="uEmail"></span></p>
    <p><strong>Address:</strong> <span id="uAddress"></span></p>
    <p><strong>Phone:</strong> <span id="uPhone"></span></p>
    <button onclick="logout()" class="logout-btn">Logout</button>
  </div>
</header>

<!-- ORDERS SECTION -->
<section class="orders-container">
  <h2 style="color:#e84949;">Delivered Orders</h2>
  <div id="ordersList"></div>
</section>

<footer class="footer">
  Â© 2025 Book Store. All rights reserved.
</footer>

<script>
  // USER AUTH CHECK
  let logged = localStorage.getItem("loggedIn");
  let user = JSON.parse(localStorage.getItem("user"));
  if (!logged || !user) window.location.href="login.html";

  // SET USER DETAILS
  document.getElementById("userNameText").innerText = user.username;
  document.getElementById("uName").innerText = user.username;
  document.getElementById("uEmail").innerText = user.email;
  document.getElementById("uAddress").innerText = user.address;
  document.getElementById("uPhone").innerText = user.phone;

  function toggleUserBox() {
    let box=document.getElementById("userBox");
    box.style.display = box.style.display==="block" ? "none" : "block";
  }
  function logout(){
    localStorage.removeItem("loggedIn");
    window.location.href="login.html";
  }

  // LOAD DELIVERED ORDERS
  let completed = JSON.parse(localStorage.getItem("completedorders")) || [];

  // ---------- PRE-LOAD SAMPLE DELIVERED ORDERS (ONLY IF EMPTY) ----------
  if (completed.length === 0) {
    completed = [
      {
        user: user.username,
        address: user.address,
        phone: user.phone,
        payment: "UPI",
        date: "2025-01-14",
        items: [
          { title: "The Silent Patient", price: 399, author: "Alex Michaelides" },
          { title: "Atomic Habits", price: 499, author: "James Clear" }
        ]
      },
      {
        user: user.username,
        address: user.address,
        phone: user.phone,
        payment: "Cash on Delivery",
        date: "2025-01-11",
        items: [
          { title: "Harry Potter and the Goblet of Fire", price: 699, author: "J.K. Rowling" }
        ]
      },
      {
        user: user.username,
        address: user.address,
        phone: user.phone,
        payment: "Card Payment",
        date: "2025-01-08",
        items: [
          { title: "The Alchemist", price: 299, author: "Paulo Coelho" },
          { title: "The Psychology of Money", price: 350, author: "Morgan Housel" }
        ]
      }
    ];
    localStorage.setItem("completedorders", JSON.stringify(completed));
  }
  // ---------------------------------------------------------------------

  let ordersList = document.getElementById("ordersList");

  if (completed.length === 0) {
    ordersList.innerHTML = "<p>No delivered orders found.</p>";
  }

  completed.forEach((order, index) => {

    let totalPrice = order.items.reduce((sum,b)=>sum+Number(b.price),0);

    let itemsHTML = order.items.map(b => `
      <div class="order-item">
        <strong>${b.title}</strong> â€” â‚¹${b.price}<br>
        <span style='font-size:13px;color:#555;'>By ${b.author}</span>
      </div>
    `).join("");

    let box = document.createElement("div");
    box.className = "order-box";

    box.innerHTML = `
      <div class='order-title'>Order #${index + 1}</div>

      <div class='order-info'>
        <strong>Name:</strong> ${order.user}<br>
        <strong>Address:</strong> ${order.address}<br>
        <strong>Phone:</strong> ${order.phone}<br>
        <strong>Payment:</strong> ${order.payment}<br>
        <strong>Date:</strong> ${order.date}
      </div>

      <div class='order-items'>
        ${itemsHTML}
        <div class='total-price'>Total Price: â‚¹${totalPrice}</div>
      </div>

      <div class='delivered-tag'>âœ” Delivered Successfully</div>
    `;

    ordersList.appendChild(box);
  });
</script>

</body>
</html>
